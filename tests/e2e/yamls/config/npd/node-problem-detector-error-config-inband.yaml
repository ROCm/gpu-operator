apiVersion: v1
data:
  custom-plugin-monitor.json: |
    {
      "plugin": "custom",
      "pluginConfig": {
        "invoke_interval": "30s",
        "timeout": "15s",
        "max_output_length": 80,
        "concurrency": 3,
        "enable_message_change_based_condition_update": false
      },
      "source": "amdgpu-custom-plugin-monitor",
      "metricsReporting": true,
      "conditions": [
        {
          "type": "AMDGPUHardwareAssertionHwa",
          "reason": "AMDGPUIsUp",
          "message": "AMDGPU is up"
        },
        {
          "type": "AMDGPUDeviceInternalError",
          "reason": "AMDGPUIsUp",
          "message": "AMDGPU is up"
        }
      ],
      "rules": [
        {
          "type": "permanent",
          "condition": "AMDGPUHardwareAssertionHwa",
          "reason": "AMDGPU Hardware Assertion",
          "path": "/var/lib/amd-metrics-exporter/amdgpuhealth",
          "args": [
            "query",
            "inband-ras-errors",
            "-s=CPER_SEVERITY_FATAL",
            "--afid=30",
            "-t=-1"
          ],
          "timeout": "15s"
        },
        {
          "type": "permanent",
          "condition": "AMDGPUDeviceInternalError",
          "reason": "AMDGPU Device Internal Error",
          "path": "/var/lib/amd-metrics-exporter/amdgpuhealth",
          "args": [
            "query",
            "inband-ras-errors",
            "-s=CPER_SEVERITY_FATAL",
            "--afid=25",
            "-t=0"
          ],
          "timeout": "15s"
        }
      ]
    }
kind: ConfigMap
metadata:
  name: node-problem-detector-config
  namespace: kube-system
